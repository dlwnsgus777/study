## 자바에 무슨 일이 일어나고 있는가?

---

### 역사의 흐름

현재까지 자바의 역사를 통틀어 자바 8에서 가장 큰 변화가 일어났다.

사과의 무게순으로 정렬하는 코드가 있다고 할 때 기존의 버전에서는 다음과 같이 작성했다.

```java
Collections.sort(inventory, new Comparator<Apple>() {
  public int compare(Apple a1, Apple a2) {
    return a1.getWeight().compareTo(a2.getWeight())
  }
});
```

하지만 자바8 에서는 위의 코드를 더욱 간결하게 작성할 수 있다.

```java
inventory.sort(comparing(Apple::getWeight));
```

**멀티코어 CPU** 의 대중화 또한 자바8에 많은 영향을 끼쳤다.

기존 자바는 다른 코어들을 사용하기 위해서 스레드를 사용했다.

하지만 스레드를 사용하게 되면 관리하기 어렵고 많은 문제가 발생할 수 있다.

자바 8 이전까지 이러한 문제를 해결하기 위해 많은 기능들이 도입되었지만 여전히 개발자들이 다루기에는 어려웠다.

자바8 에서는 **몇 가지 규칙을 지키면 단순한 방식으로 병렬 실행**을 할 수 있다.

자바 9에서는 **리액티브 프로그래밍** 이라는 병렬 실행 기법으 지원한다.

간단하게 자바 8에 추가된 기능은 다음과 같다.

- 스트림 API
- 메서드에 코드를 전달하는 기법
- 인터페이스의 디폴트 메서드

---

### 왜 아직도 자바는 변하는가?

프로그래밍 언어는 생태계와 닮아있다. 즉, 새로운 언어가 등장하면서 **진화하지 않는 기존 언어는 사장된다.**

우리는 완벽한 언어를 원하지만 각각의 언어에는 장단점이 존재하기 때문에 특정 분야에 장점을 가진 언어는 다른 경쟁 언어를 도태시킨다.

### 프로그래밍 언어 생태계에서 자바의 위치

자바는 처음부터 많은 유용한 라이브러리를 포함한 잘 설계된 객체지향 언어로 시작했다.

코드를 JVM 바이트 코드로 컴파일하는 특징 때문에 자바는 인터넷 애플리케이션 프로그램의 주요 언어가 되었다.

하지만 빅데이터 (테라바이트 이상의 데이터 셋) 라는 새로운 바람이 불면서 **멀티 코어 컴퓨터나 컴퓨터 클러스터** 를 이용해 빅데이터를 효과적으로 쳐리할 필요성이 커졌다.

즉, 병렬 프로세싱을 활용해야하는데 지금까지의 자바로는 충분히 대응이 되지 않았다.

때문에 자바 8 에서는 더욱 다양한 프로그래밍 도구와 더 다양한 문제를 해결할 수 있도록 변화했다.

자바 8에 추가된 기능은 기존에 자바에 없던 새로운 개념이지만 시장에서 요구하는 기능을 효과적으로 제공한다.

큰 시스템의 셜계 방식도 자바의 환경 변화의 큰 요소이다.

최근 외부에서 큰 하위세스템 컴포넌트를 추가하고 다른 벤더가 만든 컴포넌트를 이용해 개발하는 사례가 늘고 있는데 자바8, 자바9에서는 이런 설계 스타일에 적응할 수 있도록 **디폴트 메서드와 모듈** 을 제공한다.

---

### 스트림 처리

스트림이란 **한 번에 한 개 씩 만들어지는 연속적인 데이터 항목들의 모임** 이다.

이론적으로 어떤 프로그램의 출력 스트림은 다른 프로그램의 입력 스트림이 될 수 있다.

스트림 API의 핵심은 기존에 한 번에 한 항목을 처리했지만 우리가 하려는 작업을 고수준으로 추상화해서 일련의 스트림으로 만들어 처리할 수 있다는 것이다.

스트림 파이프라인을 이용해 입력 부분을 여러 CPU 코어에 쉽게 할당할 수 있다는 부가적인 이득을 얻을 수 있는데 이는 스레드를 사용하지 않으면서 공짜로 병렬성을 얻을 수 있게 해준다.

---

### 동작 파라미터화로 메서드에 코드 전달하기

자바 8에 추가된 두 번째 프로그램 개념은 **코드 일부를 API 로 전달하는 기능이다.**

만약 어떤 리스트를 정렬시에 특정 정렬 조건이 있다면 해당 특정 정렬 조건에 맞는 정렬 메서드를 구현해야할 것이다.

하지만 자바 8 이전에는 메서드를 다른 메서드에 전달할 방법이 없어서 해당 구현을 복잡하게 했지만 자바8 에서는 **메서드를 다른 메서드의 인수로 넘겨주는 기능** 을 제공하기 때문에 특정 조건에 맞는 정렬 메서드를 구현해 쉽게 전달할 수 있다.

이러한 기능을 **동작 파라미터화** 라고 부른다.

---

### 병렬성과 공유 가변 데이터

스트림 메서드로 전달하는 코드의 동작 방식을 조금 바꾸게 되면 병렬성을 얻을 수 있다.

스트림 메서드로 전달하는 코드는 다른 코드와 동시에 실행하더라도 안전하게 실행될 수 있어야하며 이를 만들려면 공유된 가변 데이터에 접근하지 않아야한다.

이런 함수를 **순수 함수** 라 부른다.

예를 들어 두 프로세스가 공유된 변수를 동시에 바꾸려 하면 기존처럼 `synchronized` 를 이용할 수 있지만 이는 시스템 성능에 악영향을 끼친다.

하지만 자바8 스트림을 이용하면 쉽게 병렬성을 확보할 수 있다.

---

### 자바 함수

함수라는 용어는 정적 메서드와 같은 의미로 사용된다.

자바의 함수는 부작용을 일으키지 않는 함수를 의미한다.

자바 프로그램에서 조작할 수 있는 값에는

- 기본값
- 객체(객체 참조)

가 있다. 심지어 배열도 객체이다.

프로그래밍 언어의 핵심은 **값을 바꾸는 것** 이다.

이러한 값을 **일급 값** 이라고하는데 자바 8에서는 메서드를 **일급 값** 으로 바꾸었다.

---

### 메서드와 람다를 일급 시민으로

자바 8에서는 메서드를 값으로 취급할 수 있게하여 프로그래머들이 더 쉽게 프로그램을 구현할 수 있는 환경이 제공되도록 했다.

첫번째로 **메서드 참조** 를 사용해 코드의 양을 줄일 수 있었다.

두번째로 자바 8에서는 메서드를 일급값으로 취급할 뿐 아니라 **람다** 를 포함하여 함수도 값으로 취급할 수 있게되었다.

이용할 수 있는 편리한 클래스나 메서드가 없을 때 람다 문법을 사용하면 더 간결하게 코드를 구현할 수 있다.

---

### 코드 넘겨주기

각각의 요구사항이 다르지만 비슷한 코드가 있다면 자바 8에서는 코드를 인수로 넘겨줄 수 있기 때문에 해당 메서드들을 중복으로 구현할 필요가 없어졌다.

### 메서드 전달에서 람다로

메서드를 값으로 넘겨주는 것은 유용하지만 한 두번만 사용할 메서드를 매번 정의하는 것은 귀찮은 일이다.

때문에 자바 8에서는 **익명함수, 람다** 같은 새로운 개념을 도입해 코드를 간결하게 구현할 수 있다.

### 스트림

모든 자바 애플리케이션은 컬렉션을 활용한다.

컬렉션을 활용해 복잡한 로직을 구현할 때 스트림 API를 이용하면 코드의 양을 줄일 수 있다.

컬렉션에서 `for-each` 루프를 이용해 각 요소를 반복해 작업을 수행하는 것을 **외부 반복** 이라고 한다.

스트림 API 에서는 라이브러리 내부에서 모든 데이터가 처리되기 때문에 이와 같은 반복을 **내부 반복** 이라고 한다.

또한 컬렉션으로 많은 요소를 반복하다보면 오랜 시간이 걸릴 수도 있는데 스트림에서는 이와 같은 문제를 해결할 수 있다.

### 멀티스레딩은 어렵다

스레드를 잘 제어하지 못하면 원하지 않는 방식으로 데이터가 바뀔 수 있다.

자바 8은 스트림 API를 통해

- 컬렉션을 처리하면서 발생하는 모호함과 반복적인 코드
- 멀티코어 활용 어려움

의 두가지 문제를 해결했다.

두 CPU를 가진 환경에서 리스트를 필터랑 할 때 한 CPU는 앞부분을 다른 CPU는 뒷부분을 처리하도록 요청할 수 있는데 이 과정을 **포킹 단계** 라고 한다.

**컬렉션은 어떻게 데이터를 저장하고 접근할지에 중점**을 두는 반면
**스트림은 데이터에 어떤 계산을 할 것인지 묘사하는 것에 중점**을 둔다는 점을 기억하자.

또한 스트림은 스트림 내의 요소를 쉽게 병렬로 처리할 수 있는 환경을 제공한다는 것이 핵심이다.

---

### 디폴트 메서드와 자바 모듈

자바 9에서는 모듈 시스템의 모듈을 정의하는 문법을 제공하므로 이를 통해 패키지 모음을 포함하는 모듈을 정의할 수 있다.

또한 자바 8에서는 인터페이스를 쉽게 바꿀 수 있도록 디폴트 메서드를 지원한다.

디폴트 메서드는 인터페이스를 구현한 수많은 클래스에 영향을 주지않고 인터페이스에 기능을 추가할 수 있도록 해준다.

---

### 함수형 프로그래밍에서 가져온 다른 유용한 아이디어

자바 8에서는 `NullPointer` 예외를 피할 수 있도록 도와주는 `Optional<T>` 클래스를 제공한다.

`Optional<T>` 는 값을 갖거나 갖지 않을 수 있는 컨테이너 객체이다.

떄문에 값이 없는 상황에서 어떻게 처리할 지 명시적으로 구현하는 메서드를 포함하고 있다.

또한 **패턴 매칭** 도 지원하는데 자바 8에서는 아직 안벽하게 지원하지 않은 상태이다.
